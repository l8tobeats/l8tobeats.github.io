<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio to Video Converter</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 50px auto; text-align: center; }
        .upload-box { border: 2px dashed #ccc; padding: 40px; margin: 20px 0; }
        #status { font-weight: bold; margin-top: 20px; }
        #result a { display: inline-block; margin-top: 10px; padding: 10px 15px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Audio to Video Converter</h1>
    <p>Select your audio and image file. The conversion will happen online and your video will be ready to download.</p>

    <div class="upload-box">
        <label for="audioFile">1. Select Audio File (.mp3):</label><br>
        <input type="file" id="audioFile" accept="audio/mpeg"><br><br>

        <label for="imageFile">2. Select Cover Image (.png, .jpg):</label><br>
        <input type="file" id="imageFile" accept="image/png, image/jpeg">
    </div>

    <button id="createButton">Create Video</button>

    <div id="status"></div>
    <div id="result"></div>

    <script>
        // Votre URL de production n8n Cloud, propre et définitive
        const n8nWebhookUrl = 'https://diezeprodia.app.n8n.cloud/webhook/085087bb-25a4-44f7-ba7b-c348ef2dca75';

        const createButton = document.getElementById('createButton');
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');

        createButton.addEventListener('click', async () => {
            const audioFile = document.getElementById('audioFile').files[0];
            const imageFile = document.getElementById('imageFile').files[0];

            if (!audioFile || !imageFile) {
                statusDiv.innerText = '⚠️ Please select both an audio and an image file.';
                return;
            }

            createButton.disabled = true;
            statusDiv.innerText = 'Uploading and processing... This can take a few moments.';
            resultDiv.innerHTML = '';

            const formData = new FormData();
            formData.append('files0', audioFile);
            formData.append('files1', imageFile);

            try {
                const response = await fetch(n8nWebhookUrl, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Server error (${response.status}): ${errorText}`);
                }
                
                statusDiv.innerText = '✅ Conversion successful! Preparing download...';

                const videoBlob = await response.blob();
                const videoUrl = URL.createObjectURL(videoBlob);
                const downloadLink = document.createElement('a');
                downloadLink.href = videoUrl;
                downloadLink.download = audioFile.name.replace(/\.[^/.]+$/, '.mp4');
                downloadLink.innerText = '⬇️ Download Your Video';
                
                resultDiv.appendChild(downloadLink);
                statusDiv.innerText = 'Your video is ready!';

            } catch (error) {
                statusDiv.innerText = '❌ An error occurred. Please try again.';
                console.error(error);
            } finally {
                createButton.disabled = false;
            }
        });
    </script>
</body>
</html>